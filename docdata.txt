from smbprotocol.connection import Connection
from smbprotocol.session import Session
from smbprotocol.tree import TreeConnect
from smbprotocol.open import CreateDisposition, Directory, Open

# SMB Connection Details
server = "smb-server-ip-or-hostname"
share = "share-name"
username = "your-username"
password = "your-password"

# The path where you want to create a new directory
directory_path = "\\new-folder"

# Establish the SMB connection
conn = Connection(uuid="client-uuid", server=server, port=445)
conn.connect()

# Authenticate session
session = Session(conn, username, password)
session.connect()

# Connect to the shared folder
tree = TreeConnect(session, f"\\\\{server}\\{share}")
tree.connect()

# Open/Create the directory
directory = Open(tree, directory_path, Directory)
directory.create(disposition=CreateDisposition.FILE_CREATE)

# Close the directory handle
directory.close()

# Disconnect from SMB
tree.disconnect()
session.disconnect()
conn.disconnect()

print(f"Directory '{directory_path}' created successfully on {server}/{share}")