Ah, I get what you mean 👍 — you’re thinking: “If it was only memory, the worker would still connect to Redis, register itself, and then later die. So Flower should at least see it briefly.”

That’s a very good intuition. Let’s unpack:

⸻

🔹 How a Celery worker registers with Flower
	•	A worker process must fully start → connect to the broker (Redis) → send a hello heartbeat → then Flower lists it.
	•	If the worker never reaches that point (crashes during startup), Flower will never know it existed.

⸻

🔹 Why an OOMKilled worker might never show
	1.	OOM happens before broker handshake
	•	If your pod limits are too low, Celery may fork multiple worker processes as soon as it starts.
	•	Each child allocates memory, and the pod is OOMKilled before any worker manages to connect to Redis.
	•	Result: nothing in Flower.
	2.	Crash-loop timing
	•	Even if a worker connects once, if it dies within a few seconds, Flower might miss it unless you’re watching live (workers are removed quickly if no heartbeats arrive).
	3.	Prefork vs solo pool
	•	Prefork mode (--pool=prefork) spawns child processes immediately → memory spike → OOM before connect.
	•	In solo pool (--pool=solo), there’s only one process, so you usually see it in Flower even with tiny memory.

⸻

🔹 Why this matches your situation
	•	In TAS, your workers probably had more RAM. Prefork succeeded, so Flower saw them.
	•	In OCP, the pod limit is tighter. Worker forks N children → pod OOMKilled before Redis handshake. Flower never lists them.

⸻

✅ How to prove it
	1.	Run worker in solo mode in OCP:

celery -A app worker --pool=solo --loglevel=DEBUG

	•	If it shows up in Flower, your issue is pure memory pressure from prefork.

	2.	Set explicit low concurrency:

env:
- name: CELERYD_CONCURRENCY
  value: "2"

Then restart. If it appears in Flower, you confirmed OOM was killing before handshake.

	3.	Check OCP pod logs with --previous. If you see no Celery/Kombu connection messages, it died before handshake.

⸻

🔹 Bottom line
	•	Yes, it can be memory alone and still never appear in Flower, if OOM happens before the broker handshake.
	•	That’s why your OCP pod shows OOMKilled but nothing in Flower.

⸻

👉 Do you want me to suggest a safe-start profile (solo pool + concurrency=1, small page size) you can run in OCP just to confirm visibility in Flower before tuning memory back up?
